<html>
<head>
<title>utils.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8ea765;}
.s1 { color: #cc7832;}
.s2 { color: #cfd2d5;}
.s3 { color: #cc7832; font-weight: bold;}
.s4 { color: #6897bb;}
.s5 { color: #8a8a8a; font-style: italic;}
.s6 { color: #808080;}
</style>
</head>
<body bgcolor="#1c1c1c">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
utils.js</font>
</center></td></tr></table>
<pre><span class="s0">'use strict'</span><span class="s1">;</span>

<span class="s2">Object.defineProperty(exports</span><span class="s1">, </span><span class="s0">'__esModule'</span><span class="s1">, </span><span class="s2">{</span>
  <span class="s2">value: </span><span class="s3">true</span>
<span class="s2">})</span><span class="s1">;</span>
<span class="s2">exports.wrapAnsiString =</span>
  <span class="s2">exports.trimAndFormatPath =</span>
  <span class="s2">exports.relativePath =</span>
  <span class="s2">exports.printDisplayName =</span>
  <span class="s2">exports.getSummary =</span>
  <span class="s2">exports.formatTestPath =</span>
    <span class="s3">void </span><span class="s4">0</span><span class="s1">;</span>

<span class="s3">function </span><span class="s2">path() {</span>
  <span class="s3">const </span><span class="s2">data = _interopRequireWildcard(require(</span><span class="s0">'path'</span><span class="s2">))</span><span class="s1">;</span>

  <span class="s2">path = </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>

  <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s2">_chalk() {</span>
  <span class="s3">const </span><span class="s2">data = _interopRequireDefault(require(</span><span class="s0">'chalk'</span><span class="s2">))</span><span class="s1">;</span>

  <span class="s2">_chalk = </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>

  <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s2">_slash() {</span>
  <span class="s3">const </span><span class="s2">data = _interopRequireDefault(require(</span><span class="s0">'slash'</span><span class="s2">))</span><span class="s1">;</span>

  <span class="s2">_slash = </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>

  <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s2">_jestUtil() {</span>
  <span class="s3">const </span><span class="s2">data = require(</span><span class="s0">'jest-util'</span><span class="s2">)</span><span class="s1">;</span>

  <span class="s2">_jestUtil = </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>

  <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s2">_interopRequireDefault(obj) {</span>
  <span class="s3">return </span><span class="s2">obj &amp;&amp; obj.__esModule ? obj : {</span><span class="s3">default</span><span class="s2">: obj}</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s2">_getRequireWildcardCache(nodeInterop) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s2">WeakMap !== </span><span class="s0">'function'</span><span class="s2">) </span><span class="s3">return null</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">cacheBabelInterop = </span><span class="s3">new </span><span class="s2">WeakMap()</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">cacheNodeInterop = </span><span class="s3">new </span><span class="s2">WeakMap()</span><span class="s1">;</span>
  <span class="s3">return </span><span class="s2">(_getRequireWildcardCache = </span><span class="s3">function </span><span class="s2">(nodeInterop) {</span>
    <span class="s3">return </span><span class="s2">nodeInterop ? cacheNodeInterop : cacheBabelInterop</span><span class="s1">;</span>
  <span class="s2">})(nodeInterop)</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s2">_interopRequireWildcard(obj</span><span class="s1">, </span><span class="s2">nodeInterop) {</span>
  <span class="s3">if </span><span class="s2">(!nodeInterop &amp;&amp; obj &amp;&amp; obj.__esModule) {</span>
    <span class="s3">return </span><span class="s2">obj</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s3">if </span><span class="s2">(obj === </span><span class="s3">null </span><span class="s2">|| (</span><span class="s3">typeof </span><span class="s2">obj !== </span><span class="s0">'object' </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">obj !== </span><span class="s0">'function'</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s2">{</span><span class="s3">default</span><span class="s2">: obj}</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s3">var </span><span class="s2">cache = _getRequireWildcardCache(nodeInterop)</span><span class="s1">;</span>
  <span class="s3">if </span><span class="s2">(cache &amp;&amp; cache.has(obj)) {</span>
    <span class="s3">return </span><span class="s2">cache.get(obj)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s3">var </span><span class="s2">newObj = {}</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s2">hasPropertyDescriptor =</span>
    <span class="s2">Object.defineProperty &amp;&amp; Object.getOwnPropertyDescriptor</span><span class="s1">;</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s2">key </span><span class="s3">in </span><span class="s2">obj) {</span>
    <span class="s3">if </span><span class="s2">(key !== </span><span class="s0">'default' </span><span class="s2">&amp;&amp; Object.prototype.hasOwnProperty.call(obj</span><span class="s1">, </span><span class="s2">key)) {</span>
      <span class="s3">var </span><span class="s2">desc = hasPropertyDescriptor</span>
        <span class="s2">? Object.getOwnPropertyDescriptor(obj</span><span class="s1">, </span><span class="s2">key)</span>
        <span class="s2">: </span><span class="s3">null</span><span class="s1">;</span>
      <span class="s3">if </span><span class="s2">(desc &amp;&amp; (desc.get || desc.set)) {</span>
        <span class="s2">Object.defineProperty(newObj</span><span class="s1">, </span><span class="s2">key</span><span class="s1">, </span><span class="s2">desc)</span><span class="s1">;</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s2">newObj[key] = obj[key]</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s2">newObj.default = obj</span><span class="s1">;</span>
  <span class="s3">if </span><span class="s2">(cache) {</span>
    <span class="s2">cache.set(obj</span><span class="s1">, </span><span class="s2">newObj)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s2">newObj</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s5">/**</span>
 <span class="s5">* Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.</span>
 <span class="s5">*</span>
 <span class="s5">* This source code is licensed under the MIT license found in the</span>
 <span class="s5">* LICENSE file in the root directory of this source tree.</span>
 <span class="s5">*/</span>
<span class="s3">const </span><span class="s2">PROGRESS_BAR_WIDTH = </span><span class="s4">40</span><span class="s1">;</span>

<span class="s3">const </span><span class="s2">printDisplayName = config =&gt; {</span>
  <span class="s3">const </span><span class="s2">{displayName} = config</span><span class="s1">;</span>

  <span class="s3">const </span><span class="s2">white = _chalk().default.reset.inverse.white</span><span class="s1">;</span>

  <span class="s3">if </span><span class="s2">(!displayName) {</span>
    <span class="s3">return </span><span class="s0">''</span><span class="s1">;</span>
  <span class="s2">}</span>

  <span class="s3">const </span><span class="s2">{name</span><span class="s1">, </span><span class="s2">color} = displayName</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">chosenColor = _chalk().default.reset.inverse[color]</span>
    <span class="s2">? _chalk().default.reset.inverse[color]</span>
    <span class="s2">: white</span><span class="s1">;</span>
  <span class="s3">return </span><span class="s2">_chalk().default.supportsColor ? chosenColor(</span><span class="s0">` </span><span class="s2">${name} </span><span class="s0">`</span><span class="s2">) : name</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>

<span class="s2">exports.printDisplayName = printDisplayName</span><span class="s1">;</span>

<span class="s3">const </span><span class="s2">trimAndFormatPath = (pad</span><span class="s1">, </span><span class="s2">config</span><span class="s1">, </span><span class="s2">testPath</span><span class="s1">, </span><span class="s2">columns) =&gt; {</span>
  <span class="s3">const </span><span class="s2">maxLength = columns - pad</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">relative = relativePath(config</span><span class="s1">, </span><span class="s2">testPath)</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">{basename} = relative</span><span class="s1">;</span>
  <span class="s3">let </span><span class="s2">{dirname} = relative</span><span class="s1">; </span><span class="s6">// length is ok</span>

  <span class="s3">if </span><span class="s2">((dirname + path().sep + basename).length &lt;= maxLength) {</span>
    <span class="s3">return </span><span class="s2">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_slash().default)(</span>
      <span class="s2">_chalk().default.dim(dirname + path().sep) +</span>
        <span class="s2">_chalk().default.bold(basename)</span>
    <span class="s2">)</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s6">// we can fit trimmed dirname and full basename</span>

  <span class="s3">const </span><span class="s2">basenameLength = basename.length</span><span class="s1">;</span>

  <span class="s3">if </span><span class="s2">(basenameLength + </span><span class="s4">4 </span><span class="s2">&lt; maxLength) {</span>
    <span class="s3">const </span><span class="s2">dirnameLength = maxLength - </span><span class="s4">4 </span><span class="s2">- basenameLength</span><span class="s1">;</span>
    <span class="s2">dirname =</span>
      <span class="s0">'...' </span><span class="s2">+ dirname.slice(dirname.length - dirnameLength</span><span class="s1">, </span><span class="s2">dirname.length)</span><span class="s1">;</span>
    <span class="s3">return </span><span class="s2">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_slash().default)(</span>
      <span class="s2">_chalk().default.dim(dirname + path().sep) +</span>
        <span class="s2">_chalk().default.bold(basename)</span>
    <span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(basenameLength + </span><span class="s4">4 </span><span class="s2">=== maxLength) {</span>
    <span class="s3">return </span><span class="s2">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_slash().default)(</span>
      <span class="s2">_chalk().default.dim(</span><span class="s0">'...' </span><span class="s2">+ path().sep) + _chalk().default.bold(basename)</span>
    <span class="s2">)</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s6">// can't fit dirname, but can fit trimmed basename</span>

  <span class="s3">return </span><span class="s2">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_slash().default)(</span>
    <span class="s2">_chalk().default.bold(</span>
      <span class="s0">'...' </span><span class="s2">+ basename.slice(basename.length - maxLength - </span><span class="s4">4</span><span class="s1">, </span><span class="s2">basename.length)</span>
    <span class="s2">)</span>
  <span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>

<span class="s2">exports.trimAndFormatPath = trimAndFormatPath</span><span class="s1">;</span>

<span class="s3">const </span><span class="s2">formatTestPath = (config</span><span class="s1">, </span><span class="s2">testPath) =&gt; {</span>
  <span class="s3">const </span><span class="s2">{dirname</span><span class="s1">, </span><span class="s2">basename} = relativePath(config</span><span class="s1">, </span><span class="s2">testPath)</span><span class="s1">;</span>
  <span class="s3">return </span><span class="s2">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_slash().default)(</span>
    <span class="s2">_chalk().default.dim(dirname + path().sep) + _chalk().default.bold(basename)</span>
  <span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>

<span class="s2">exports.formatTestPath = formatTestPath</span><span class="s1">;</span>

<span class="s3">const </span><span class="s2">relativePath = (config</span><span class="s1">, </span><span class="s2">testPath) =&gt; {</span>
  <span class="s6">// this function can be called with ProjectConfigs or GlobalConfigs. GlobalConfigs</span>
  <span class="s6">// do not have config.cwd, only config.rootDir. Try using config.cwd, fallback</span>
  <span class="s6">// to config.rootDir. (Also, some unit just use config.rootDir, which is ok)</span>
  <span class="s2">testPath = path().relative(config.cwd || config.rootDir</span><span class="s1">, </span><span class="s2">testPath)</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">dirname = path().dirname(testPath)</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">basename = path().basename(testPath)</span><span class="s1">;</span>
  <span class="s3">return </span><span class="s2">{</span>
    <span class="s2">basename</span><span class="s1">,</span>
    <span class="s2">dirname</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>

<span class="s2">exports.relativePath = relativePath</span><span class="s1">;</span>

<span class="s3">const </span><span class="s2">getValuesCurrentTestCases = (currentTestCases = []) =&gt; {</span>
  <span class="s3">let </span><span class="s2">numFailingTests = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">let </span><span class="s2">numPassingTests = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">let </span><span class="s2">numPendingTests = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">let </span><span class="s2">numTodoTests = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">let </span><span class="s2">numTotalTests = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s2">currentTestCases.forEach(testCase =&gt; {</span>
    <span class="s3">switch </span><span class="s2">(testCase.testCaseResult.status) {</span>
      <span class="s3">case </span><span class="s0">'failed'</span><span class="s2">: {</span>
        <span class="s2">numFailingTests++</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s2">}</span>

      <span class="s3">case </span><span class="s0">'passed'</span><span class="s2">: {</span>
        <span class="s2">numPassingTests++</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s2">}</span>

      <span class="s3">case </span><span class="s0">'skipped'</span><span class="s2">: {</span>
        <span class="s2">numPendingTests++</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s2">}</span>

      <span class="s3">case </span><span class="s0">'todo'</span><span class="s2">: {</span>
        <span class="s2">numTodoTests++</span><span class="s1">;</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s2">numTotalTests++</span><span class="s1">;</span>
  <span class="s2">})</span><span class="s1">;</span>
  <span class="s3">return </span><span class="s2">{</span>
    <span class="s2">numFailingTests</span><span class="s1">,</span>
    <span class="s2">numPassingTests</span><span class="s1">,</span>
    <span class="s2">numPendingTests</span><span class="s1">,</span>
    <span class="s2">numTodoTests</span><span class="s1">,</span>
    <span class="s2">numTotalTests</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>

<span class="s3">const </span><span class="s2">getSummary = (aggregatedResults</span><span class="s1">, </span><span class="s2">options) =&gt; {</span>
  <span class="s3">let </span><span class="s2">runTime = (Date.now() - aggregatedResults.startTime) / </span><span class="s4">1000</span><span class="s1">;</span>

  <span class="s3">if </span><span class="s2">(options &amp;&amp; options.roundTime) {</span>
    <span class="s2">runTime = Math.floor(runTime)</span><span class="s1">;</span>
  <span class="s2">}</span>

  <span class="s3">const </span><span class="s2">valuesForCurrentTestCases = getValuesCurrentTestCases(</span>
    <span class="s2">options === </span><span class="s3">null </span><span class="s2">|| options === </span><span class="s3">void </span><span class="s4">0 </span><span class="s2">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s2">: options.currentTestCases</span>
  <span class="s2">)</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">estimatedTime = (options &amp;&amp; options.estimatedTime) || </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotResults = aggregatedResults.snapshot</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotsAdded = snapshotResults.added</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotsFailed = snapshotResults.unmatched</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotsOutdated = snapshotResults.unchecked</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotsFilesRemoved = snapshotResults.filesRemoved</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotsDidUpdate = snapshotResults.didUpdate</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotsPassed = snapshotResults.matched</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotsTotal = snapshotResults.total</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshotsUpdated = snapshotResults.updated</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">suitesFailed = aggregatedResults.numFailedTestSuites</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">suitesPassed = aggregatedResults.numPassedTestSuites</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">suitesPending = aggregatedResults.numPendingTestSuites</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">suitesRun = suitesFailed + suitesPassed</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">suitesTotal = aggregatedResults.numTotalTestSuites</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">testsFailed = aggregatedResults.numFailedTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">testsPassed = aggregatedResults.numPassedTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">testsPending = aggregatedResults.numPendingTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">testsTodo = aggregatedResults.numTodoTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">testsTotal = aggregatedResults.numTotalTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">width = (options &amp;&amp; options.width) || </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">suites =</span>
    <span class="s2">_chalk().default.bold(</span><span class="s0">'Test Suites: '</span><span class="s2">) +</span>
    <span class="s2">(suitesFailed</span>
      <span class="s2">? _chalk().default.bold.red(</span><span class="s0">`</span><span class="s2">${suitesFailed} </span><span class="s0">failed`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(suitesPending</span>
      <span class="s2">? _chalk().default.bold.yellow(</span><span class="s0">`</span><span class="s2">${suitesPending} </span><span class="s0">skipped`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(suitesPassed</span>
      <span class="s2">? _chalk().default.bold.green(</span><span class="s0">`</span><span class="s2">${suitesPassed} </span><span class="s0">passed`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(suitesRun !== suitesTotal</span>
      <span class="s2">? suitesRun + </span><span class="s0">' of ' </span><span class="s2">+ suitesTotal</span>
      <span class="s2">: suitesTotal) +</span>
    <span class="s0">' total'</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">updatedTestsFailed =</span>
    <span class="s2">testsFailed + valuesForCurrentTestCases.numFailingTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">updatedTestsPending =</span>
    <span class="s2">testsPending + valuesForCurrentTestCases.numPendingTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">updatedTestsTodo = testsTodo + valuesForCurrentTestCases.numTodoTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">updatedTestsPassed =</span>
    <span class="s2">testsPassed + valuesForCurrentTestCases.numPassingTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">updatedTestsTotal =</span>
    <span class="s2">testsTotal + valuesForCurrentTestCases.numTotalTests</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">tests =</span>
    <span class="s2">_chalk().default.bold(</span><span class="s0">'Tests:       '</span><span class="s2">) +</span>
    <span class="s2">(updatedTestsFailed &gt; </span><span class="s4">0</span>
      <span class="s2">? _chalk().default.bold.red(</span><span class="s0">`</span><span class="s2">${updatedTestsFailed} </span><span class="s0">failed`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(updatedTestsPending &gt; </span><span class="s4">0</span>
      <span class="s2">? _chalk().default.bold.yellow(</span><span class="s0">`</span><span class="s2">${updatedTestsPending} </span><span class="s0">skipped`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(updatedTestsTodo &gt; </span><span class="s4">0</span>
      <span class="s2">? _chalk().default.bold.magenta(</span><span class="s0">`</span><span class="s2">${updatedTestsTodo} </span><span class="s0">todo`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(updatedTestsPassed &gt; </span><span class="s4">0</span>
      <span class="s2">? _chalk().default.bold.green(</span><span class="s0">`</span><span class="s2">${updatedTestsPassed} </span><span class="s0">passed`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s0">`</span><span class="s2">${updatedTestsTotal} </span><span class="s0">total`</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">snapshots =</span>
    <span class="s2">_chalk().default.bold(</span><span class="s0">'Snapshots:   '</span><span class="s2">) +</span>
    <span class="s2">(snapshotsFailed</span>
      <span class="s2">? _chalk().default.bold.red(</span><span class="s0">`</span><span class="s2">${snapshotsFailed} </span><span class="s0">failed`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(snapshotsOutdated &amp;&amp; !snapshotsDidUpdate</span>
      <span class="s2">? _chalk().default.bold.yellow(</span><span class="s0">`</span><span class="s2">${snapshotsOutdated} </span><span class="s0">obsolete`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(snapshotsOutdated &amp;&amp; snapshotsDidUpdate</span>
      <span class="s2">? _chalk().default.bold.green(</span><span class="s0">`</span><span class="s2">${snapshotsOutdated} </span><span class="s0">removed`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(snapshotsFilesRemoved &amp;&amp; !snapshotsDidUpdate</span>
      <span class="s2">? _chalk().default.bold.yellow(</span>
          <span class="s2">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_jestUtil().pluralize)(</span><span class="s0">'file'</span><span class="s1">, </span><span class="s2">snapshotsFilesRemoved) +</span>
            <span class="s0">' obsolete'</span>
        <span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(snapshotsFilesRemoved &amp;&amp; snapshotsDidUpdate</span>
      <span class="s2">? _chalk().default.bold.green(</span>
          <span class="s2">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_jestUtil().pluralize)(</span><span class="s0">'file'</span><span class="s1">, </span><span class="s2">snapshotsFilesRemoved) + </span><span class="s0">' removed'</span>
        <span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(snapshotsUpdated</span>
      <span class="s2">? _chalk().default.bold.green(</span><span class="s0">`</span><span class="s2">${snapshotsUpdated} </span><span class="s0">updated`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(snapshotsAdded</span>
      <span class="s2">? _chalk().default.bold.green(</span><span class="s0">`</span><span class="s2">${snapshotsAdded} </span><span class="s0">written`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s2">(snapshotsPassed</span>
      <span class="s2">? _chalk().default.bold.green(</span><span class="s0">`</span><span class="s2">${snapshotsPassed} </span><span class="s0">passed`</span><span class="s2">) + </span><span class="s0">', '</span>
      <span class="s2">: </span><span class="s0">''</span><span class="s2">) +</span>
    <span class="s0">`</span><span class="s2">${snapshotsTotal} </span><span class="s0">total`</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">time = renderTime(runTime</span><span class="s1">, </span><span class="s2">estimatedTime</span><span class="s1">, </span><span class="s2">width)</span><span class="s1">;</span>
  <span class="s3">return </span><span class="s2">[suites</span><span class="s1">, </span><span class="s2">tests</span><span class="s1">, </span><span class="s2">snapshots</span><span class="s1">, </span><span class="s2">time].join(</span><span class="s0">'</span><span class="s1">\n</span><span class="s0">'</span><span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>

<span class="s2">exports.getSummary = getSummary</span><span class="s1">;</span>

<span class="s3">const </span><span class="s2">renderTime = (runTime</span><span class="s1">, </span><span class="s2">estimatedTime</span><span class="s1">, </span><span class="s2">width) =&gt; {</span>
  <span class="s6">// If we are more than one second over the estimated time, highlight it.</span>
  <span class="s3">const </span><span class="s2">renderedTime =</span>
    <span class="s2">estimatedTime &amp;&amp; runTime &gt;= estimatedTime + </span><span class="s4">1</span>
      <span class="s2">? _chalk().default.bold.yellow((</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_jestUtil().formatTime)(runTime</span><span class="s1">, </span><span class="s4">0</span><span class="s2">))</span>
      <span class="s2">: (</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_jestUtil().formatTime)(runTime</span><span class="s1">, </span><span class="s4">0</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s3">let </span><span class="s2">time = _chalk().default.bold(</span><span class="s0">'Time:'</span><span class="s2">) + </span><span class="s0">`        </span><span class="s2">${renderedTime}</span><span class="s0">`</span><span class="s1">;</span>

  <span class="s3">if </span><span class="s2">(runTime &lt; estimatedTime) {</span>
    <span class="s2">time += </span><span class="s0">`, estimated </span><span class="s2">${(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_jestUtil().formatTime)(estimatedTime</span><span class="s1">, </span><span class="s4">0</span><span class="s2">)}</span><span class="s0">`</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s6">// Only show a progress bar if the test run is actually going to take</span>
  <span class="s6">// some time.</span>

  <span class="s3">if </span><span class="s2">(estimatedTime &gt; </span><span class="s4">2 </span><span class="s2">&amp;&amp; runTime &lt; estimatedTime &amp;&amp; width) {</span>
    <span class="s3">const </span><span class="s2">availableWidth = Math.min(PROGRESS_BAR_WIDTH</span><span class="s1">, </span><span class="s2">width)</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">length = Math.min(</span>
      <span class="s2">Math.floor((runTime / estimatedTime) * availableWidth)</span><span class="s1">,</span>
      <span class="s2">availableWidth</span>
    <span class="s2">)</span><span class="s1">;</span>

    <span class="s3">if </span><span class="s2">(availableWidth &gt;= </span><span class="s4">2</span><span class="s2">) {</span>
      <span class="s2">time +=</span>
        <span class="s0">'</span><span class="s1">\n</span><span class="s0">' </span><span class="s2">+</span>
        <span class="s2">_chalk().default.green(</span><span class="s0">'█'</span><span class="s2">).repeat(length) +</span>
        <span class="s2">_chalk()</span>
          <span class="s2">.default.white(</span><span class="s0">'█'</span><span class="s2">)</span>
          <span class="s2">.repeat(availableWidth - length)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s2">time</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">; </span><span class="s6">// word-wrap a string that contains ANSI escape sequences.</span>
<span class="s6">// ANSI escape sequences do not add to the string length.</span>

<span class="s3">const </span><span class="s2">wrapAnsiString = (string</span><span class="s1">, </span><span class="s2">terminalWidth) =&gt; {</span>
  <span class="s3">if </span><span class="s2">(terminalWidth === </span><span class="s4">0</span><span class="s2">) {</span>
    <span class="s6">// if the terminal width is zero, don't bother word-wrapping</span>
    <span class="s3">return </span><span class="s2">string</span><span class="s1">;</span>
  <span class="s2">}</span>

  <span class="s3">const </span><span class="s2">ANSI_REGEXP = </span><span class="s4">/[\u001b\u009b]\[\d{1,2}m/gu</span><span class="s1">;</span>
  <span class="s3">const </span><span class="s2">tokens = []</span><span class="s1">;</span>
  <span class="s3">let </span><span class="s2">lastIndex = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">let </span><span class="s2">match</span><span class="s1">;</span>

  <span class="s3">while </span><span class="s2">((match = ANSI_REGEXP.exec(string))) {</span>
    <span class="s3">const </span><span class="s2">ansi = match[</span><span class="s4">0</span><span class="s2">]</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">index = match[</span><span class="s0">'index'</span><span class="s2">]</span><span class="s1">;</span>

    <span class="s3">if </span><span class="s2">(index != lastIndex) {</span>
      <span class="s2">tokens.push([</span><span class="s0">'string'</span><span class="s1">, </span><span class="s2">string.slice(lastIndex</span><span class="s1">, </span><span class="s2">index)])</span><span class="s1">;</span>
    <span class="s2">}</span>

    <span class="s2">tokens.push([</span><span class="s0">'ansi'</span><span class="s1">, </span><span class="s2">ansi])</span><span class="s1">;</span>
    <span class="s2">lastIndex = index + ansi.length</span><span class="s1">;</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(lastIndex != string.length - </span><span class="s4">1</span><span class="s2">) {</span>
    <span class="s2">tokens.push([</span><span class="s0">'string'</span><span class="s1">, </span><span class="s2">string.slice(lastIndex</span><span class="s1">, </span><span class="s2">string.length)])</span><span class="s1">;</span>
  <span class="s2">}</span>

  <span class="s3">let </span><span class="s2">lastLineLength = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">return </span><span class="s2">tokens</span>
    <span class="s2">.reduce(</span>
      <span class="s2">(lines</span><span class="s1">, </span><span class="s2">[kind</span><span class="s1">, </span><span class="s2">token]) =&gt; {</span>
        <span class="s3">if </span><span class="s2">(kind === </span><span class="s0">'string'</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(lastLineLength + token.length &gt; terminalWidth) {</span>
            <span class="s3">while </span><span class="s2">(token.length) {</span>
              <span class="s3">const </span><span class="s2">chunk = token.slice(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">terminalWidth - lastLineLength)</span><span class="s1">;</span>
              <span class="s3">const </span><span class="s2">remaining = token.slice(</span>
                <span class="s2">terminalWidth - lastLineLength</span><span class="s1">,</span>
                <span class="s2">token.length</span>
              <span class="s2">)</span><span class="s1">;</span>
              <span class="s2">lines[lines.length - </span><span class="s4">1</span><span class="s2">] += chunk</span><span class="s1">;</span>
              <span class="s2">lastLineLength += chunk.length</span><span class="s1">;</span>
              <span class="s2">token = remaining</span><span class="s1">;</span>

              <span class="s3">if </span><span class="s2">(token.length) {</span>
                <span class="s2">lines.push(</span><span class="s0">''</span><span class="s2">)</span><span class="s1">;</span>
                <span class="s2">lastLineLength = </span><span class="s4">0</span><span class="s1">;</span>
              <span class="s2">}</span>
            <span class="s2">}</span>
          <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s2">lines[lines.length - </span><span class="s4">1</span><span class="s2">] += token</span><span class="s1">;</span>
            <span class="s2">lastLineLength += token.length</span><span class="s1">;</span>
          <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s2">lines[lines.length - </span><span class="s4">1</span><span class="s2">] += token</span><span class="s1">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">lines</span><span class="s1">;</span>
      <span class="s2">}</span><span class="s1">,</span>
      <span class="s2">[</span><span class="s0">''</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s2">.join(</span><span class="s0">'</span><span class="s1">\n</span><span class="s0">'</span><span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>

<span class="s2">exports.wrapAnsiString = wrapAnsiString</span><span class="s1">;</span>
</pre>
</body>
</html>